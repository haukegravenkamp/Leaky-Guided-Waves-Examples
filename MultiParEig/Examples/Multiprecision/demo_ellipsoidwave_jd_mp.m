%DEMO_ELLIPSOIDWAVE_JD_MP   demo for the Jacobi-Davidson method for 
% three-parameter eigenvalue problems combined by multiprecision refinement
%
% This example computes first 30 eigenmodes of an ellipsoid with semi-axes 1, 1.5, and 2
% The related Helmholtz equation separated in ellipsoidal coordinates is
% discretized with the Chebyshev collocation and solved as a
% three-parameter eigenvalue problem using the Jacobi-Davidson method

% Reference: M. Willatzen and L. C. Lew Yan Voon, Numerical implementation of the ellipsoidal 
% wave equation and application to ellipsoidal quantum dots, Comput. Phys. Commun. 171 (2005) 1-18.
%
% See also: ELLIPSOIDWAVE_MEP, ELLIPSOID_EIGS, DEMO_ELLIPSOIDWAVE_FIGS.

% Reference: B. Plestenjak, C. I. Gheorghiu, M. E. Hochstenbach: Spectral
% collocation for multiparameter eigenvalue problems arising from separable
% boundary value problems, J. Comp. Phys. 298 (2015) 585-601

% MultiParEig toolbox
% B. Plestenjak, University of Ljubljana
% FreeBSD License, see LICENSE.txt

% Last revision: 21.11.2016

% We use matrices so large that we can not use threepareigs. We use threepareigs_jd 
% which calls threepareig to solve the smaller projected three-parameter.
% We compute twice as much eigenvalues with higher accuracy and faster as 
% in demo_ellipsoidwave. In the end we use computation in multiple
% precision to refine the results.

% Example output:
%
%   omega                      |   lambda                        mu                           eta                        | rho sigma tau  
% ----------------------------------------------------------------------------------------------------------------------------------------
%   2.344589792808837884295990 |   0.849892094167228691066745   -3.752317823833895356643524   2.404981817237732844326569 |  0    0    0 
%   2.943674347484530341381168 |   3.600376067342189319792223   -7.769447307776814568962483   3.791033165516833023273745 |  1    0    0 
%   3.207950933790060470994531 |   1.484386252916852363112420   -7.850914765375677463846131   4.502290272201977911132245 |  0    1    0 
%   3.577282765053422692245000 |   7.226437436235008312808214  -13.031227564048740865728844   5.598666491752364352638195 |  0    0    0 
%   3.786416510636805138126574 |   5.487314946539550522446366  -13.258841294844927791844188   6.272415621510062096500794 |  1    1    0 
%   3.826636258473813191177994 |   1.511894058719228511912822   -8.871771153545071212507107   6.406375961416578016618565 |  0    0    1 
%   4.130647322833803550673916 |   2.054584746275202100163302  -13.469948281564512614186782   7.464733196214904965261303 |  0    0    0 
%   4.232158707906114701117431 |  11.788297019350207168452823  -19.586896452164750896398406   7.836135706396180003437188 |  1    0    0 
%   4.386937764424803286483099 |   5.553318265806652618202900  -14.802423715108791735346177   8.419785040159714749354967 |  1    0    1 
%   4.388591780850989948223480 |  10.420653413674179039022220  -19.874909303488917366407477   8.426135295791877730498498 |  0    1    0 
%   4.615779340352415309131779 |   2.124536328535912357566759  -14.649304910209563308168310   9.321120776985577965170741 |  0    1    1 
%   4.707778120270192492481037 |   7.169502991554702719002411  -20.330546065123544047296809   9.696388987991451816286118 |  1    0    0 
%   4.897899305842562716039299 |  17.341820240380707415182061  -27.454186447664877709705769  10.495370204450712747392407 |  0    0    0 
%   4.972294406138819372920429 |  10.393627615379514728402481  -21.879973101202019140396827  10.816623851827235058248023 |  0    0    1 
%   5.006814614924295431129427 |  16.335111253514190062716367  -27.734968519769594439769223  10.967334257346040324326980 |  1    1    0 
%   5.076582928769472518627808 |   2.628835651255500995387001  -20.633950636373390106455887  11.275116226794715438436243 |  0    1    0 
%   5.169338019560318374790650 |   7.385469176086267459608238  -21.904788151484688274098692  11.690899307706410100930754 |  1    1    1 
%   5.309340828298879730294342 |  13.154662531461628931183449  -28.404806772691060043566422  12.332731263580627503413287 |  0    0    0 
%   5.378072227996133689857955 |   2.185488864950726751160998  -16.226090797797751427957718  12.654101639175192609700211 |  0    0    0 
%   5.446998420027855814893339 |   2.693802673666288298924624  -21.815239068376429317345416  12.980533907156356432248189 |  0    0    1 
%   5.565846570142930338004468 |  23.948764110666255619510595  -36.626996095276520551665326  13.553158518537671933848660 |  1    0    0 
%   5.577448999153690211612782 |  16.080761501166913144665824  -30.155035411009927920939010  13.609722585445219027749168 |  1    0    1 
%   5.634978980239078090419951 |  23.272643172353442214978445  -36.855726480312464270651359  13.891932297134605187358099 |  0    1    0 
%   5.649479297264784797161032 |   8.890963773311206277854616  -28.962343927369475157603441  13.963519644472740417474567 |  1    1    0 
%   5.741798992215306999378520 |  13.505548277320849292532883  -30.301856287711323145616609  14.423611854314562851022147 |  0    1    1 
%   5.927284174896523520887660 |   7.563132378715018028828310  -24.193594452633825559574627  15.370555239365708213455805 |  1    0    0 
%   5.933444707829646135255817 |  20.007957579571855345114759  -37.744258362875013844717882  15.402522669131340220415693 |  1    0    0 
%   6.000047501712373637192012 |   9.078782309398467332422863  -30.428069969204233437989861  15.750249384977142142070209 |  1    0    1 
%   6.031700414160975430196167 |   3.202117884798096838860350  -29.336710653723711439105334  15.916866825207986108599627 |  0    0    0 
%   6.153242861328409677275592 |   2.792574347141463868761970  -23.845263664759058558272874  16.564798998338952517391617 |  0    1    0 

is_numeric_type_supported('mp'); % check if MCT is installed

N = 100; % number of collocation nodes 
x0 = mp('1');
y0 = mp('1.5');
z0 = mp('2');

a2 = z0^2-x0^2;
b2 = z0^2-y0^2;
c = a2/b2;
Momega = mp([]); 
Mlambda = mp([]); 
Mmu = mp([]); 
Meta = mp([]); 
Mrst = mp([]); 

neig = 10;
RST = [0 0 0;1 0 0;0 1 0;0 0 1;1 1 0;1 0 1;0 1 1; 1 1 1];
for izb = 1:8
    fprintf('Computing first %d eigenmodes of type (r,s,t) = (%d,%d,%d) \n',neig,RST(izb,1),RST(izb,2),RST(izb,3))
    [omega,X1,X2,X3,xi1,xi2,xi3,lambda,mu,eta] = ellipsoid_eigs_jd_mp(x0,y0,z0,RST(izb,1),RST(izb,2),RST(izb,3),neig,N,N,N);
    Momega = [Momega; omega];
    Mlambda = [Mlambda; lambda]; 
    Mmu = [Mmu; mu]; 
    Meta = [Meta; eta];
    Mrst = [Mrst; ones(neig,1)*RST(izb,:)];
end

[Momega, ord] = sort(Momega);
Mlambda = Mlambda(ord); 
Mmu = Mmu(ord); 
Meta = Meta(ord); 
Mrst = Mrst(ord,:);

disp('  omega                      |   lambda                        mu                           eta                        | rho sigma tau  ');
disp('----------------------------------------------------------------------------------------------------------------------------------------');
for j=1:30
   fprintf('%28.24f | %28.24f %29.24f %28.24f |  %d    %d    %d \n',...
       Momega(j), Mlambda(j),Mmu(j),Meta(j),Mrst(j,1),Mrst(j,2),Mrst(j,3))
end


